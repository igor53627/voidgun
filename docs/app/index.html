<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voidgun</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');
        
        :root {
            --bg: #0a0a0c;
            --card-bg: #111114;
            --border: #1f1f24;
            --text: #e4e4e7;
            --text-dim: #71717a;
            --accent: #84cc16;
            --accent-dim: #65a30d;
            --error: #ef4444;
            --warning: #f59e0b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .ascii-logo {
            font-size: 0.6rem;
            color: var(--accent);
            white-space: pre;
            margin-bottom: 2rem;
            text-align: center;
            opacity: 0.9;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            color: var(--text-dim);
            font-size: 0.85rem;
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            max-width: 420px;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        
        .progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 0 1rem;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.4;
            transition: opacity 0.3s;
        }
        
        .step.active {
            opacity: 1;
        }
        
        .step.completed {
            opacity: 0.7;
        }
        
        .step-num {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .step.active .step-num {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .step.completed .step-num {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
        }
        
        .step-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .step.active .step-label {
            color: var(--text);
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .card-desc {
            color: var(--text-dim);
            font-size: 0.8rem;
            margin-bottom: 1.5rem;
        }
        
        .ascii-box {
            background: var(--bg);
            border: 1px dashed var(--border);
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.7rem;
            color: var(--text-dim);
            white-space: pre;
            overflow-x: auto;
        }
        
        .btn {
            width: 100%;
            padding: 0.875rem;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .btn-primary {
            background: var(--accent);
            color: var(--bg);
        }
        
        .btn-primary:hover {
            background: var(--accent-dim);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            margin-top: 0.75rem;
        }
        
        .btn-secondary:hover {
            border-color: var(--text-dim);
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--border);
            font-size: 0.8rem;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: var(--text-dim);
        }
        
        .info-value {
            color: var(--text);
            font-weight: 500;
        }
        
        .info-value.accent {
            color: var(--accent);
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-dim);
        }
        
        .status-dot.connected {
            background: var(--accent);
            box-shadow: 0 0 8px var(--accent);
        }
        
        .status-dot.pending {
            background: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .hidden {
            display: none;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--text);
        }
        
        .input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .balance-display {
            text-align: center;
            padding: 2rem;
            background: var(--bg);
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }
        
        .balance-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        
        .balance-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }
        
        .balance-token {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-left: 0.5rem;
        }
        
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .actions .btn {
            padding: 0.75rem;
        }
        
        footer {
            margin-top: auto;
            padding-top: 2rem;
            text-align: center;
        }
        
        footer a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.75rem;
            margin: 0 0.75rem;
            transition: color 0.2s;
        }
        
        footer a:hover {
            color: var(--accent);
        }
        
        .note-list {
            margin-bottom: 1.5rem;
        }
        
        .note-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }
        
        .note-token {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .note-icon {
            width: 24px;
            height: 24px;
            background: var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .note-amount {
            color: var(--accent);
            font-weight: 600;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 100;
        }
        
        .modal {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }
        
        .modal-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .modal-actions .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <pre class="ascii-logo">
â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
 â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
  â•šâ•â•â•â•   â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•
    </pre>
    
    <header>
        <h1>VOIDGUN</h1>
        <p class="tagline">privacy via proxy // railgun integration</p>
    </header>
    
    <!-- Stage 0: Connect Wallet -->
    <div class="card" id="stage-connect">
        <div class="progress">
            <div class="step active" data-step="0">
                <div class="step-num">1</div>
                <div class="step-label">Wallet</div>
            </div>
            <div class="step" data-step="1">
                <div class="step-num">2</div>
                <div class="step-label">Network</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-num">3</div>
                <div class="step-label">Keys</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-num">4</div>
                <div class="step-label">Ready</div>
            </div>
        </div>
        
        <h2 class="card-title">Connect Wallet</h2>
        <p class="card-desc">Connect your Ethereum wallet to begin. Your keys will be derived from a signature.</p>
        
        <div class="ascii-box">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•­â”€â”€â”€â”€â”€â”€â•®                           â”‚
â”‚  â”‚ ğŸ‘›  â”‚  Your wallet retains      â”‚
â”‚  â•°â”€â”€â”€â”€â”€â”€â•¯  full spending authority  â”‚
â”‚                                     â”‚
â”‚  The proxy cannot steal funds -     â”‚
â”‚  only wallet-signed transactions    â”‚
â”‚  authorize spends.                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>
        
        <button class="btn btn-primary" onclick="connectWallet()">
            Connect Wallet
        </button>
    </div>
    
    <!-- Stage 1: Add Network -->
    <div class="card hidden" id="stage-network">
        <div class="progress">
            <div class="step completed" data-step="0">
                <div class="step-num">âœ“</div>
                <div class="step-label">Wallet</div>
            </div>
            <div class="step active" data-step="1">
                <div class="step-num">2</div>
                <div class="step-label">Network</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-num">3</div>
                <div class="step-label">Keys</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-num">4</div>
                <div class="step-label">Ready</div>
            </div>
        </div>
        
        <div class="status">
            <div class="status-dot connected"></div>
            <span id="connected-address">0x0000...0000</span>
        </div>
        
        <h2 class="card-title">Add Voidgun Network</h2>
        <p class="card-desc">Add Voidgun as a custom RPC network in your wallet. Transactions route through the privacy proxy.</p>
        
        <div class="info-row">
            <span class="info-label">Network Name</span>
            <span class="info-value">Voidgun</span>
        </div>
        <div class="info-row">
            <span class="info-label">RPC URL</span>
            <span class="info-value">https://rpc.voidgun.io</span>
        </div>
        <div class="info-row">
            <span class="info-label">Chain ID</span>
            <span class="info-value">1</span>
        </div>
        <div class="info-row" style="margin-bottom: 1.5rem;">
            <span class="info-label">Currency</span>
            <span class="info-value">ETH</span>
        </div>
        
        <button class="btn btn-primary" onclick="addNetwork()">
            Add Network
        </button>
        <button class="btn btn-secondary" onclick="skipNetwork()">
            Skip (Manual Setup)
        </button>
    </div>
    
    <!-- Stage 2: Derive Keys -->
    <div class="card hidden" id="stage-keys">
        <div class="progress">
            <div class="step completed" data-step="0">
                <div class="step-num">âœ“</div>
                <div class="step-label">Wallet</div>
            </div>
            <div class="step completed" data-step="1">
                <div class="step-num">âœ“</div>
                <div class="step-label">Network</div>
            </div>
            <div class="step active" data-step="2">
                <div class="step-num">3</div>
                <div class="step-label">Keys</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-num">4</div>
                <div class="step-label">Ready</div>
            </div>
        </div>
        
        <div class="status">
            <div class="status-dot connected"></div>
            <span id="connected-address-2">0x0000...0000</span>
        </div>
        
        <h2 class="card-title">Derive Privacy Keys</h2>
        <p class="card-desc">Sign a message to derive your Railgun keys. No new seed phrase needed.</p>
        
        <div class="ascii-box">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Signature â†’ keccak256 â†’ Entropy    â”‚
â”‚      â†“                              â”‚
â”‚  BIP39 Mnemonic (12 words)          â”‚
â”‚      â†“                              â”‚
â”‚  BIP32 Baby Jubjub Keys             â”‚
â”‚      â”œâ”€â”€ Spending Key (EdDSA)       â”‚
â”‚      â”œâ”€â”€ Viewing Key                â”‚
â”‚      â””â”€â”€ Nullifying Key             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>
        
        <button class="btn btn-primary" onclick="deriveKeys()">
            Sign & Derive Keys
        </button>
    </div>
    
    <!-- Stage 3: Ready / Dashboard -->
    <div class="card hidden" id="stage-ready">
        <div class="progress">
            <div class="step completed" data-step="0">
                <div class="step-num">âœ“</div>
                <div class="step-label">Wallet</div>
            </div>
            <div class="step completed" data-step="1">
                <div class="step-num">âœ“</div>
                <div class="step-label">Network</div>
            </div>
            <div class="step completed" data-step="2">
                <div class="step-num">âœ“</div>
                <div class="step-label">Keys</div>
            </div>
            <div class="step active" data-step="3">
                <div class="step-num">âœ“</div>
                <div class="step-label">Ready</div>
            </div>
        </div>
        
        <div class="status">
            <div class="status-dot connected"></div>
            <span id="connected-address-3">0x0000...0000</span>
        </div>
        
        <div class="balance-display">
            <div class="balance-label">Shielded Balance</div>
            <div>
                <span class="balance-value" id="balance-value">0.00</span>
                <span class="balance-token">ETH</span>
            </div>
        </div>
        
        <div class="note-list" id="note-list">
            <!-- Notes will be populated here -->
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="showShield()">Shield</button>
            <button class="btn btn-secondary" onclick="showUnshield()">Unshield</button>
        </div>
        <button class="btn btn-secondary" style="margin-top: 0.75rem;" onclick="showTransfer()">
            Transfer
        </button>
    </div>
    
    <!-- Shield Modal -->
    <div class="modal-overlay hidden" id="modal-shield">
        <div class="modal">
            <h3 class="modal-title">Shield Funds</h3>
            <p class="card-desc">Deposit tokens into the Railgun pool. Your balance becomes private.</p>
            
            <div class="input-group">
                <label class="input-label">Amount</label>
                <input type="text" class="input" id="shield-amount" placeholder="0.0">
            </div>
            
            <div class="input-group">
                <label class="input-label">Token</label>
                <input type="text" class="input" value="ETH" disabled>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideModal('modal-shield')">Cancel</button>
                <button class="btn btn-primary" onclick="executeShield()">Shield</button>
            </div>
        </div>
    </div>
    
    <!-- Transfer Modal -->
    <div class="modal-overlay hidden" id="modal-transfer">
        <div class="modal">
            <h3 class="modal-title">Private Transfer</h3>
            <p class="card-desc">Send to another 0zk address. Fully private, on-chain.</p>
            
            <div class="input-group">
                <label class="input-label">Recipient (0zk address)</label>
                <input type="text" class="input" id="transfer-to" placeholder="0zk...">
            </div>
            
            <div class="input-group">
                <label class="input-label">Amount</label>
                <input type="text" class="input" id="transfer-amount" placeholder="0.0">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideModal('modal-transfer')">Cancel</button>
                <button class="btn btn-primary" onclick="executeTransfer()">Transfer</button>
            </div>
        </div>
    </div>
    
    <!-- Unshield Modal -->
    <div class="modal-overlay hidden" id="modal-unshield">
        <div class="modal">
            <h3 class="modal-title">Unshield Funds</h3>
            <p class="card-desc">Withdraw to a public Ethereum address.</p>
            
            <div class="input-group">
                <label class="input-label">Recipient Address</label>
                <input type="text" class="input" id="unshield-to" placeholder="0x...">
            </div>
            
            <div class="input-group">
                <label class="input-label">Amount</label>
                <input type="text" class="input" id="unshield-amount" placeholder="0.0">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideModal('modal-unshield')">Cancel</button>
                <button class="btn btn-primary" onclick="executeUnshield()">Unshield</button>
            </div>
        </div>
    </div>
    
    <footer>
        <a href="https://github.com/igor53627/voidgun">GitHub</a>
        <a href="protocol-visualization.html">Docs</a>
        <a href="https://railgun.org">Railgun</a>
    </footer>
    
    <script>
        // State
        let currentStage = 0;
        let connectedAddress = null;
        let keysInitialized = false;
        let balance = 0;
        let notes = [];
        
        // Mock wallet connection (replace with actual ethers.js or wagmi)
        async function connectWallet() {
            // Simulate wallet connection
            await simulateDelay(800);
            
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    connectedAddress = accounts[0];
                } catch (err) {
                    connectedAddress = generateMockAddress();
                }
            } else {
                connectedAddress = generateMockAddress();
            }
            
            updateAddressDisplays();
            showStage(1);
        }
        
        async function addNetwork() {
            await simulateDelay(600);
            
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x1',
                            chainName: 'Voidgun',
                            rpcUrls: ['https://rpc.voidgun.io'],
                            nativeCurrency: {
                                name: 'Ether',
                                symbol: 'ETH',
                                decimals: 18
                            }
                        }]
                    });
                } catch (err) {
                    console.log('Network add skipped');
                }
            }
            
            showStage(2);
        }
        
        function skipNetwork() {
            showStage(2);
        }
        
        async function deriveKeys() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Signing...';
            
            await simulateDelay(500);
            
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const message = 'Authorize Railgun privacy pool access via Voidgun proxy.\n\nThis signature will be used to derive your Railgun wallet keys deterministically.';
                    await window.ethereum.request({
                        method: 'personal_sign',
                        params: [message, connectedAddress]
                    });
                } catch (err) {
                    console.log('Signature rejected, using demo mode');
                }
            }
            
            btn.textContent = 'Deriving Keys...';
            await simulateDelay(1000);
            
            keysInitialized = true;
            balance = 0;
            notes = [];
            
            showStage(3);
        }
        
        function showStage(stage) {
            currentStage = stage;
            
            document.getElementById('stage-connect').classList.add('hidden');
            document.getElementById('stage-network').classList.add('hidden');
            document.getElementById('stage-keys').classList.add('hidden');
            document.getElementById('stage-ready').classList.add('hidden');
            
            const stageIds = ['stage-connect', 'stage-network', 'stage-keys', 'stage-ready'];
            document.getElementById(stageIds[stage]).classList.remove('hidden');
            
            if (stage === 3) {
                updateDashboard();
            }
        }
        
        function updateAddressDisplays() {
            const shortAddr = connectedAddress 
                ? connectedAddress.slice(0, 6) + '...' + connectedAddress.slice(-4)
                : '0x0000...0000';
            
            document.getElementById('connected-address').textContent = shortAddr;
            document.getElementById('connected-address-2').textContent = shortAddr;
            document.getElementById('connected-address-3').textContent = shortAddr;
        }
        
        function updateDashboard() {
            document.getElementById('balance-value').textContent = balance.toFixed(4);
            
            const noteList = document.getElementById('note-list');
            noteList.innerHTML = '';
            
            if (notes.length === 0) {
                noteList.innerHTML = `
                    <div class="note-item" style="justify-content: center; color: var(--text-dim);">
                        No shielded notes yet
                    </div>
                `;
            } else {
                notes.forEach((note, i) => {
                    noteList.innerHTML += `
                        <div class="note-item">
                            <div class="note-token">
                                <div class="note-icon">${note.token === 'ETH' ? 'Î' : '$'}</div>
                                <span>${note.token}</span>
                            </div>
                            <span class="note-amount">${note.value.toFixed(4)}</span>
                        </div>
                    `;
                });
            }
        }
        
        function showShield() {
            document.getElementById('modal-shield').classList.remove('hidden');
        }
        
        function showTransfer() {
            document.getElementById('modal-transfer').classList.remove('hidden');
        }
        
        function showUnshield() {
            document.getElementById('modal-unshield').classList.remove('hidden');
        }
        
        function hideModal(id) {
            document.getElementById(id).classList.add('hidden');
        }
        
        async function executeShield() {
            const amount = parseFloat(document.getElementById('shield-amount').value) || 0;
            if (amount <= 0) return;
            
            await simulateDelay(1500);
            
            balance += amount;
            notes.push({ token: 'ETH', value: amount });
            
            hideModal('modal-shield');
            updateDashboard();
            document.getElementById('shield-amount').value = '';
        }
        
        async function executeTransfer() {
            const to = document.getElementById('transfer-to').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value) || 0;
            
            if (!to || amount <= 0 || amount > balance) return;
            
            await simulateDelay(2000);
            
            balance -= amount;
            notes = notes.filter(n => {
                if (n.value <= amount) return false;
                n.value -= amount;
                return true;
            });
            
            hideModal('modal-transfer');
            updateDashboard();
            document.getElementById('transfer-to').value = '';
            document.getElementById('transfer-amount').value = '';
        }
        
        async function executeUnshield() {
            const to = document.getElementById('unshield-to').value;
            const amount = parseFloat(document.getElementById('unshield-amount').value) || 0;
            
            if (!to || amount <= 0 || amount > balance) return;
            
            await simulateDelay(2000);
            
            balance -= amount;
            notes = notes.filter(n => {
                if (n.value <= amount) return false;
                n.value -= amount;
                return true;
            });
            
            hideModal('modal-unshield');
            updateDashboard();
            document.getElementById('unshield-to').value = '';
            document.getElementById('unshield-amount').value = '';
        }
        
        // Utilities
        function simulateDelay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function generateMockAddress() {
            const chars = '0123456789abcdef';
            let addr = '0x';
            for (let i = 0; i < 40; i++) {
                addr += chars[Math.floor(Math.random() * 16)];
            }
            return addr;
        }
        
        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
